{% extends 'base.html' %}
{% load static %}

{% block title %}Аптечная полка | Каталог{% endblock %}

{% block content %}
<div class="catalog-container">
    <!-- Фильтры и поиск -->
    <div class="catalog-header">
        <h1>Найти лекарства у других</h1>
        <p>Пользователи, которые готовы поделиться своими лекарствами</p>
        
        <div class="search-filters">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Название лекарства...">
            </div>
            
            <div class="filters">
                <select id="cityFilter">
                    <option value="">Все города</option>
                    <option value="moscow">Москва</option>
                    <option value="spb">Санкт-Петербург</option>
                </select>
                
                <select id="formFilter">
                    <option value="">Все формы</option>
                    <option value="tablet">Таблетки</option>
                    <option value="capsule">Капсулы</option>
                    <option value="solution">Раствор</option>
                </select>
                
                <button class="btn-filter">
                    <i class="fas fa-filter"></i> Фильтры
                </button>
            </div>
        </div>
    </div>
    
    <!-- Сетка карточек -->
    <div class="medications-grid" id="medicationsGrid">
        {% for medication in user_medications %}
        <div class="med-card" data-id="{{ medication.id }}">
            <!-- Заголовок карточки -->
            <div class="med-header">
                <h3>{{ medication.medication.name }}</h3>
                <span class="med-dosage">
                    {{ medication.medication.dosage_number }} 
                    {{ medication.medication.dosage_type.type_name }}
                </span>
            </div>
            
            <!-- Информация о лекарстве -->
            <div class="med-info">
                <div class="info-row">
                    <i class="fas fa-industry"></i>
                    <span>{{ medication.medication.manufacturer.name }}</span>
                </div>
                <div class="info-row">
                    <i class="fas fa-pills"></i>
                    <span>{{ medication.medication.release_form.form_name }}</span>
                </div>
                <div class="info-row">
                    <i class="fas fa-box"></i>
                    <span>{{ medication.units_number }} {{ medication.units_type }}</span>
                </div>
                <div class="info-row">
                    <i class="fas fa-calendar-check"></i>
                    <span>Годен до: {{ medication.expiry_date|date:"d.m.Y" }}</span>
                </div>
            </div>
            
            <!-- Владелец -->
            <div class="med-owner">
                <div class="owner-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="owner-info">
                    <strong>{{ medication.user.first_name }} {{ medication.user.last_name }}</strong>
                    <span>г. Москва</span>
                </div>
            </div>
            
            <!-- Действия -->
            <div class="med-actions">
                <button class="btn-contact" onclick="contactOwner({{ medication.user.id }})">
                    <i class="fas fa-phone"></i> Связаться
                </button>
                <button class="btn-view" onclick="viewDetails({{ medication.id }})">
                    Подробнее
                </button>
            </div>
        </div>
        {% empty %}
        <div class="empty-state">
            <i class="fas fa-search"></i>
            <h3>Лекарства не найдены</h3>
            <p>Попробуйте изменить параметры поиска</p>
        </div>
        {% endfor %}
    </div>
    
    <!-- Пагинация -->
    {% if user_medications.has_other_pages %}
    <div class="pagination">
        {% if user_medications.has_previous %}
        <a href="?page={{ user_medications.previous_page_number }}">&laquo;</a>
        {% endif %}
        
        {% for num in user_medications.paginator.page_range %}
            {% if user_medications.number == num %}
            <span class="current">{{ num }}</span>
            {% else %}
            <a href="?page={{ num }}">{{ num }}</a>
            {% endif %}
        {% endfor %}
        
        {% if user_medications.has_next %}
        <a href="?page={{ user_medications.next_page_number }}">&raquo;</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
.catalog-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 30px 20px;
}

.catalog-header {
    margin-bottom: 40px;
}

.catalog-header h1 {
    font-size: 36px;
    color: #2c3e50;
    margin-bottom: 10px;
}

.search-filters {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 12px;
    margin-top: 20px;
}

.search-box {
    position: relative;
    margin-bottom: 20px;
}

.search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #95a5a6;
}

.search-box input {
    width: 100%;
    padding: 15px 15px 15px 45px;
    border: 2px solid #e0e6eb;
    border-radius: 8px;
    font-size: 16px;
}

.filters {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.filters select, .btn-filter {
    padding: 12px 20px;
    border: 2px solid #e0e6eb;
    border-radius: 8px;
    background: white;
    font-size: 15px;
    cursor: pointer;
}

.btn-filter {
    background: #3498db;
    color: white;
    border-color: #3498db;
}

/* Сетка карточек */
.medications-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.med-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    border: 1px solid #eaeaea;
    transition: transform 0.3s;
}

.med-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
}

.med-header {
    border-bottom: 2px solid #f0f7ff;
    padding-bottom: 15px;
    margin-bottom: 20px;
}

.med-header h3 {
    color: #2c3e50;
    margin-bottom: 5px;
}

.med-dosage {
    color: #3498db;
    font-weight: 500;
}

.info-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    color: #555;
}

.info-row i {
    color: #7f8c8d;
    width: 20px;
}

.med-owner {
    display: flex;
    align-items: center;
    gap: 15px;
    margin: 25px 0;
    padding-top: 20px;
    border-top: 1px solid #eee;
}

.owner-avatar i {
    font-size: 40px;
    color: #3498db;
}

.owner-info strong {
    display: block;
    margin-bottom: 5px;
}

.med-actions {
    display: flex;
    gap: 10px;
}

.btn-contact, .btn-view {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    border: none;
}

.btn-contact {
    background: #2ecc71;
    color: white;
}

.btn-view {
    background: #f8f9fa;
    color: #2c3e50;
    border: 1px solid #e0e6eb;
}

/* Адаптивность */
@media (max-width: 768px) {
    .medications-grid {
        grid-template-columns: 1fr;
    }
    
    .filters {
        flex-direction: column;
    }
}
</style>
{% endblock %}